## $RefreshSig$ is not defined

#### 현상

dev환경(on webpack-dev-server)에서는 발생하지 않고,\
실제 webpack build 후 번들링된 파일을 읽을 때 발생하는 현상

#### 원인

`RefreshSig`라는 키워드에서 유추할 수 있듯이,\
해당 이슈는 hot-reload와 관련된 플러그인, 로더에서 일어난다.

- 웹팩 플러그인인 `@pmmmwh/react-refresh-webpack-plugin`
- 바벨 로더의 플러그인 옵션값 중 하나인 `react-refresh/babel`

저 플러그인을 사용하기 위해선 `it is mandatory to set NODE_ENV value explicitely in your scripts before running webpack.` 라고 한다.

`@pmmmwh/react-refresh-webpack-plugin` 공식 문서에 따르면,\
위에서 말한 2패키지는 development 모드에서만 사용하기를 권장한다고 한다.\
production 모드에서는 아무런 동작을 안하도록 설정이 되어있다고한다.

즉 development 모드에서만 해당 플러그인, 옵션과 관련된 코드가 동작해야한다는 의미이다.

해당 코드를 보면, development와 production mode의 구분을 `process.env.NODE_ENV === 'production'` 으로 처리하는데,\
process.env.NODE_ENV는 웹팩에서는 `DefinePlugin`을 사용하지 않는이상 제공하지 않는 환경번수이다.

웹팩에서는 `webpack build --mode=production` 로 빌드하였으나,\
`--mode=production`의 옵션값은 DefinePlugin이 있을대 process.env.NODE_ENV를 세팅하게된다,\
그리고 설사 DefinePlugin을 통해 process.env.NODE_ENV 값을 세팅을 한다 한들 세팅하는 시점이 이미 webpack option값을 return한 이후이므로 의미가 없다.

결국 process.env.NODE_ENV는 undefined로 세팅이되고, 이는 hot-reload와 관련된 패키지들이 development로 인식하여 동작을 해버리게 되면서 문제가 발생한것이다.

#### 해결방법

- 웹팩이 실행되기 전에 (옵션을 reutrn하기 전에) `process.env.NODE_ENV`를 명시해준다.

#### 참고

- https://github.com/pmmmwh/react-refresh-webpack-plugin/issues/36
- https://www.youtube.com/watch?v=pzjvKB1Dkno
